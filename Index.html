<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hue Rotation | BIOS Studios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root {
            --bg-deep: #011111;
            --accent-lime: #bfff00;
            --text-mint: #eefff4;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-mint);
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
        }

        .neon-border {
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .neon-border:hover {
            border-color: var(--accent-lime);
            box-shadow: 0 0 20px rgba(191, 255, 0, 0.15);
        }

        /* Liquid Wave Animation */
        .liquid-container {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            transform: translate3d(0, 0, 0);
        }

        .wave {
            position: absolute;
            top: -150%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(238, 255, 244, 0.12);
            border-radius: 42%;
            animation: drift 10s infinite linear;
            pointer-events: none;
        }

        .wave:nth-child(2) { animation: drift 14s infinite linear; opacity: 0.3; border-radius: 38%; }
        .wave:nth-child(3) { animation: drift 18s infinite linear; opacity: 0.1; border-radius: 45%; }

        @keyframes drift {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .gradient-wheel { 
            transition: transform 0.15s cubic-bezier(0.2, 0.8, 0.2, 1); 
        }

        input[type="color"] { -webkit-appearance: none; border: none; background: none; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 2px solid white; border-radius: 50%; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: rgba(191, 255, 0, 0.2); border-radius: 10px; }

        .full-screen-zen {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-deep);
        }

        .bar {
            width: 4px;
            background: var(--accent-lime);
            border-radius: 10px;
            animation: bounce 1s ease-in-out infinite;
        }
        @keyframes bounce {
            0%, 100% { height: 12px; }
            50% { height: 32px; }
        }

        .btn-action {
            @apply p-3 rounded-full glass hover:bg-white/10 transition-all text-white shadow-xl active:scale-90;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- YouTube Background Component -->
    <div id="yt-player" class="hidden"></div>

    <div id="app" class="max-w-screen-xl mx-auto min-h-screen flex flex-col">
        
        <!-- Header -->
        <header class="p-6 md:p-10 flex justify-between items-center sticky top-0 z-30 bg-[#011111]/90 backdrop-blur-xl border-b border-white/5">
            <div>
                <h1 class="text-2xl font-black tracking-tighter uppercase leading-none text-[#bfff00]">HUE ROTATION</h1>
                <p class="text-[9px] text-slate-500 font-bold tracking-[0.4em] uppercase mt-1">A Product of Afrisoma</p>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleZenMode()" class="btn-action" title="Zen Meditation">
                    <i data-lucide="zap" class="w-5 h-5"></i>
                </button>
                <button onclick="triggerUpload()" class="btn-action" title="Extract from Image">
                    <i data-lucide="aperture" class="w-5 h-5"></i>
                </button>
                <button onclick="shuffleColors()" class="p-3 rounded-full bg-[#bfff00] text-[#011111] transition-all shadow-[0_0_20px_rgba(191,255,0,0.3)] hover:scale-110 active:rotate-180" title="Randomize">
                    <i data-lucide="refresh-ccw" class="w-5 h-5"></i>
                </button>
            </div>
            <input type="file" id="imageInput" class="hidden" accept="image/*" onchange="handleImage(event)">
        </header>

        <!-- Hero Visualization -->
        <main class="flex-1 flex flex-col items-center px-6 pt-12 pb-20">
            
            <div class="relative w-full max-w-2xl aspect-square flex items-center justify-center">
                <div class="absolute inset-0 rounded-full border border-white/5 scale-[1.08] pointer-events-none animate-pulse"></div>
                
                <!-- The Core Orb -->
                <div id="wheel" class="gradient-wheel relative w-[300px] h-[300px] sm:w-[450px] sm:h-[450px] rounded-full shadow-[0_0_120px_-20px_rgba(191,255,0,0.1)] border-[16px] border-white/5 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing">
                    <div id="liquid-bg" class="liquid-container">
                        <div class="wave"></div>
                        <div class="wave"></div>
                        <div class="wave"></div>
                    </div>
                    
                    <button onclick="saveCurrentPalette()" class="absolute z-10 glass text-[#bfff00] w-24 h-24 rounded-full shadow-2xl hover:scale-110 active:scale-95 transition-all flex flex-col items-center justify-center border border-white/20 group">
                        <i data-lucide="plus" class="w-8 h-8 group-hover:rotate-90 transition-transform"></i>
                        <span class="text-[8px] font-black uppercase tracking-widest mt-1">Capture</span>
                    </button>
                </div>

                <div class="absolute -bottom-10 flex gap-6 opacity-30">
                    <div class="flex items-center gap-2 text-[10px] uppercase tracking-widest font-bold">
                        <i data-lucide="mouse-pointer-2" class="w-3 h-3"></i> Drag to Spin
                    </div>
                </div>
            </div>

            <!-- Editor Grid -->
            <div class="mt-24 w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Color A -->
                <div class="flex items-center gap-5 p-6 rounded-[32px] glass neon-border group transition-all">
                    <div class="relative">
                        <input type="color" id="colorPickerA" oninput="updateColor('A', this.value)" class="w-16 h-16 cursor-pointer z-10 relative">
                        <div class="absolute inset-0 bg-[#bfff00]/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </div>
                    <div class="flex-1">
                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-[0.3em] mb-1 block">Channel Alpha</label>
                        <input type="text" id="colorTextA" class="w-full bg-transparent text-2xl font-bold focus:outline-none border-b border-white/10 focus:border-[#bfff00] transition-colors uppercase font-mono tracking-tighter" oninput="updateColor('A', this.value)">
                    </div>
                </div>

                <!-- Color B -->
                <div class="flex items-center gap-5 p-6 rounded-[32px] glass neon-border group transition-all">
                    <div class="relative">
                        <input type="color" id="colorPickerB" oninput="updateColor('B', this.value)" class="w-16 h-16 cursor-pointer z-10 relative">
                        <div class="absolute inset-0 bg-[#bfff00]/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </div>
                    <div class="flex-1">
                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-[0.3em] mb-1 block">Channel Beta</label>
                        <input type="text" id="colorTextB" class="w-full bg-transparent text-2xl font-bold focus:outline-none border-b border-white/10 focus:border-[#bfff00] transition-colors uppercase font-mono tracking-tighter" oninput="updateColor('B', this.value)">
                    </div>
                </div>
            </div>

            <!-- Persistence Vault -->
            <section class="mt-32 w-full">
                <div class="flex items-end justify-between mb-16 px-2">
                    <div>
                        <h2 class="text-5xl font-black tracking-tighter">VAULT</h2>
                        <p class="text-xs text-slate-500 mt-2 uppercase tracking-[0.3em]">Locally cached liquid states</p>
                    </div>
                    <div class="text-8xl font-black text-white/5 select-none leading-none" id="count">00</div>
                </div>

                <div id="paletteGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-8 md:gap-12"></div>

                <div id="empty-state" class="py-32 flex flex-col items-center justify-center opacity-10">
                    <i data-lucide="shield-off" class="w-20 h-20 mb-4"></i>
                    <p class="text-[10px] font-black uppercase tracking-[0.5em]">No data encrypted</p>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="p-16 border-t border-white/5 text-center flex flex-col items-center gap-4">
            <div class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center opacity-30">
                <i data-lucide="command" class="w-4 h-4"></i>
            </div>
            <p class="text-[10px] font-bold text-slate-700 uppercase tracking-[0.6em]">System Version 4.0.2 &bull; BIOS Studios</p>
        </footer>

        <!-- Zen Overlay -->
        <div id="zenMode" class="full-screen-zen">
            <div id="zen-liquid" class="absolute inset-0 z-0 opacity-60">
                <div class="liquid-container" id="zen-bg" style="border-radius: 0;">
                    <div class="wave" style="top: -100%; width: 300%; height: 300%; background: rgba(191, 255, 0, 0.05);"></div>
                    <div class="wave" style="top: -120%; width: 300%; height: 300%;"></div>
                </div>
            </div>
            <div class="z-10 text-center p-14 glass rounded-[60px] border border-white/10 shadow-2xl max-w-sm mx-auto">
                <div class="flex items-center justify-center gap-2 mb-8">
                    <div class="bar" style="animation-delay: 0s;"></div>
                    <div class="bar" style="animation-delay: 0.2s;"></div>
                    <h2 class="text-3xl font-black tracking-tighter uppercase px-4">FLOW STATE</h2>
                    <div class="bar" style="animation-delay: 0.2s;"></div>
                    <div class="bar" style="animation-delay: 0s;"></div>
                </div>
                
                <div class="flex justify-around mb-12">
                    <div id="zen-color-a" class="w-20 h-20 rounded-full border-8 border-white/5 shadow-2xl"></div>
                    <div id="zen-color-b" class="w-20 h-20 rounded-full border-8 border-white/5 shadow-2xl"></div>
                </div>

                <button onclick="toggleZenMode()" class="w-full py-5 bg-[#bfff00] text-[#011111] rounded-3xl font-black uppercase tracking-[0.2em] text-xs hover:scale-105 transition-all shadow-xl">
                    Exit Meditation
                </button>
            </div>
        </div>

        <!-- Image Processing Terminal -->
        <div id="pickerModal" class="fixed inset-0 z-50 glass hidden flex-col">
            <header class="p-6 flex justify-between items-center bg-black/60 border-b border-white/5">
                <h3 class="font-black uppercase tracking-widest text-sm">HUE EXTRACTION PROTOCOL</h3>
                <button onclick="closeModal()" class="p-3 glass rounded-full"><i data-lucide="x"></i></button>
            </header>
            <div class="flex-1 overflow-hidden flex items-center justify-center p-4 bg-black/20">
                <canvas id="pickerCanvas" class="max-w-full max-h-full shadow-2xl rounded-3xl cursor-crosshair"></canvas>
            </div>
            <footer class="p-10 bg-black/80 flex justify-center gap-6">
                <button onclick="setActiveSlot('A')" id="btn-pick-a" class="p-5 rounded-3xl border-2 transition-all flex items-center gap-4 bg-white/5">
                    <div id="preview-a" class="w-8 h-8 rounded-full shadow-lg"></div>
                    <span class="font-black text-[10px] uppercase tracking-widest">Target Alpha</span>
                </button>
                <button onclick="setActiveSlot('B')" id="btn-pick-b" class="p-5 rounded-3xl border-2 transition-all flex items-center gap-4 bg-white/5">
                    <div id="preview-b" class="w-8 h-8 rounded-full shadow-lg"></div>
                    <span class="font-black text-[10px] uppercase tracking-widest">Target Beta</span>
                </button>
            </footer>
        </div>

        <!-- Global Notifications -->
        <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 glass border-[#bfff00]/30 px-10 py-4 rounded-full shadow-[0_0_50px_rgba(191,255,0,0.15)] text-[10px] font-black uppercase tracking-[0.4em] hidden z-[60] text-[#bfff00]">
            DECRYPTING STATE... SYNC COMPLETE
        </div>
    </div>

    <script>
        /**
         * System State
         */
        let state = {
            colorA: '#bfff00',
            colorB: '#011111',
            activeSlot: 'A',
            rotation: 145,
            palettes: [],
            isZen: false
        };

        const STORAGE_KEY = 'bios_hue_vault_v4';
        let youtubePlayer;

        /**
         * Initialize Core Features
         */
        window.onload = () => {
            initIcons();
            loadVault();
            setActiveSlot('A');
            updateColor('A', '#bfff00');
            updateColor('B', '#011111');
        };

        function onYouTubeIframeAPIReady() {
            youtubePlayer = new YT.Player('yt-player', {
                height: '0', width: '0', videoId: '1ZYbU82GVz4',
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': '1ZYbU82GVz4' }
            });
        }

        const wheel = document.getElementById('wheel');
        const liquidBg = document.getElementById('liquid-bg');
        const zenBg = document.getElementById('zen-bg');
        const canvas = document.getElementById('pickerCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });

        function initIcons() { lucide.createIcons(); }

        /**
         * Persistence Layer (LocalStorage)
         */
        function saveVault() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.palettes));
        }

        function loadVault() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                state.palettes = JSON.parse(saved);
                renderLibrary();
            }
        }

        /**
         * Visual Control Logic
         */
        function updateColor(slot, value) {
            if (!value) return;
            if (slot === 'A') {
                state.colorA = value;
                document.getElementById('colorPickerA').value = value;
                document.getElementById('colorTextA').value = value;
            } else {
                state.colorB = value;
                document.getElementById('colorPickerB').value = value;
                document.getElementById('colorTextB').value = value;
            }
            render();
        }

        function render() {
            const grad = `linear-gradient(${state.rotation}deg, ${state.colorA}, ${state.colorB})`;
            liquidBg.style.background = grad;
            zenBg.style.background = grad;
            
            document.getElementById('zen-color-a').style.backgroundColor = state.colorA;
            document.getElementById('zen-color-b').style.backgroundColor = state.colorB;
            document.getElementById('preview-a').style.backgroundColor = state.colorA;
            document.getElementById('preview-b').style.backgroundColor = state.colorB;
        }

        function shuffleColors() {
            const randomHex = () => '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
            state.rotation += 90;
            updateColor('A', randomHex());
            updateColor('B', randomHex());
        }

        /**
         * Library Management
         */
        function saveCurrentPalette() {
            const entry = { 
                id: Date.now(), 
                a: state.colorA, 
                b: state.colorB, 
                rot: state.rotation 
            };
            state.palettes.unshift(entry);
            saveVault();
            showToast("DATA PERSISTED TO VAULT");
            renderLibrary();
        }

        function deletePalette(id) {
            state.palettes = state.palettes.filter(p => p.id !== id);
            saveVault();
            renderLibrary();
        }

        function renderLibrary() {
            const grid = document.getElementById('paletteGrid');
            const count = document.getElementById('count');
            const empty = document.getElementById('empty-state');
            
            grid.innerHTML = '';
            count.innerText = state.palettes.length.toString().padStart(2, '0');
            empty.classList.toggle('hidden', state.palettes.length > 0);

            state.palettes.forEach(p => {
                const card = document.createElement('div');
                card.className = "group relative flex flex-col p-5 glass rounded-[40px] neon-border transition-all animate-in fade-in zoom-in-95 duration-500";
                card.innerHTML = `
                    <div class="relative w-full aspect-square rounded-[30px] overflow-hidden mb-5">
                        <div class="liquid-container h-full w-full" style="background: linear-gradient(${p.rot}deg, ${p.a}, ${p.b})">
                            <div class="wave" style="animation-duration: 8s;"></div>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all bg-black/60 backdrop-blur-md gap-3">
                            <button onclick="applyPalette('${p.a}', '${p.b}', ${p.rot})" class="bg-[#bfff00] p-4 rounded-full text-black shadow-2xl hover:scale-110 active:scale-95 transition-all"><i data-lucide="play" class="w-6 h-6"></i></button>
                            <button onclick="exportCSS('${p.a}', '${p.b}', ${p.rot})" class="bg-white/10 p-4 rounded-full text-white shadow-2xl hover:scale-110 active:scale-95 transition-all border border-white/10"><i data-lucide="code" class="w-6 h-6"></i></button>
                            <button onclick="deletePalette(${p.id})" class="bg-red-500/80 p-4 rounded-full text-white shadow-2xl hover:scale-110 active:scale-95 transition-all"><i data-lucide="trash-2" class="w-6 h-6"></i></button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center px-2">
                        <span class="text-[10px] font-mono text-slate-500 uppercase tracking-tighter">${p.a}</span>
                        <div class="w-3 h-1 rounded-full bg-white/10"></div>
                        <span class="text-[10px] font-mono text-slate-500 uppercase tracking-tighter">${p.b}</span>
                    </div>
                `;
                grid.appendChild(card);
            });
            initIcons();
        }

        function applyPalette(a, b, rot) {
            state.rotation = rot;
            updateColor('A', a);
            updateColor('B', b);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showToast("RESTORED STATE");
        }

        function exportCSS(a, b, rot) {
            const css = `background: linear-gradient(${rot}deg, ${a}, ${b});`;
            navigator.clipboard.writeText(css);
            showToast("CSS COPIED TO CLIPBOARD");
        }

        /**
         * Interface Interactions
         */
        function toggleZenMode() {
            state.isZen = !state.isZen;
            document.getElementById('zenMode').style.display = state.isZen ? 'flex' : 'none';
            if (youtubePlayer && typeof youtubePlayer.playVideo === 'function') {
                state.isZen ? youtubePlayer.playVideo() : youtubePlayer.pauseVideo();
            }
        }

        function setActiveSlot(slot) {
            state.activeSlot = slot;
            const btnA = document.getElementById('btn-pick-a');
            const btnB = document.getElementById('btn-pick-b');
            btnA.style.borderColor = slot === 'A' ? '#bfff00' : 'transparent';
            btnB.style.borderColor = slot === 'B' ? '#bfff00' : 'transparent';
        }

        function handleImage(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    const maxDim = 800;
                    let w = img.width, h = img.height;
                    if (w > h) { if (w > maxDim) { h *= maxDim/w; w = maxDim; } }
                    else { if (h > maxDim) { w *= maxDim/h; h = maxDim; } }
                    
                    canvas.width = w; 
                    canvas.height = h;
                    ctx.drawImage(img, 0, 0, w, h);
                    document.getElementById('pickerModal').classList.remove('hidden');
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function closeModal() { document.getElementById('pickerModal').classList.add('hidden'); }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const sx = canvas.width / rect.width, sy = canvas.height / rect.height;
            const px = ctx.getImageData((e.clientX - rect.left) * sx, (e.clientY - rect.top) * sy, 1, 1).data;
            const hex = "#" + ("000000" + ((px[0] << 16) | (px[1] << 8) | px[2]).toString(16)).slice(-6);
            updateColor(state.activeSlot, hex);
        });

        // Rotation Manipulation
        let isDragging = false, startX = 0;
        const startDrag = (x) => { isDragging = true; startX = x; };
        const moveDrag = (x) => {
            if (!isDragging) return;
            state.rotation += (x - startX) * 0.4;
            render();
            startX = x;
        };
        wheel.addEventListener('mousedown', (e) => startDrag(e.clientX));
        window.addEventListener('mousemove', (e) => moveDrag(e.clientX));
        window.addEventListener('mouseup', () => isDragging = false);
        wheel.addEventListener('touchstart', (e) => startDrag(e.touches[0].clientX), {passive: true});
        window.addEventListener('touchmove', (e) => moveDrag(e.touches[0].clientX), {passive: true});
        window.addEventListener('touchend', () => isDragging = false);

        function triggerUpload() { document.getElementById('imageInput').click(); }
        
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 2500);
        }
    </script>
</body>
</html>
